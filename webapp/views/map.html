<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src= "https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"> </script>


<script src="/jquery/dist/jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>


<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	 <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
	 <!-- Material Design icon font -->
	 <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
  <div>
  <div>
  <nav class="navbar navbar-inverse" role="navigation" style="padding-left:130px;">
         <ul class="nav navbar-nav">
        <li><a href="/">Home</a></li>
        <li class="active"><a href="/map">Map<span class="sr-only">(current)</span></a></li>
        <li><a href="/contact">Contact me</a></li>
      </ul>
</nav>
</div>
  <br/>
  <div class="jumbotron">


    	<title>Map</title>
    	<style>
    #myMap {
       height: 500px;
       width: screen.width;;
    }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false">
    </script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">
    </script>

		<script src="/socket.io/socket.io.js"></script>

    <script type="text/javascript">
    var map;
    var marker;
		var latt = -37.910524;
		var long = 145.136218;
    var myLatlng = new google.maps.LatLng(-37.910524,145.136218);
    var geocoder = new google.maps.Geocoder();
    var infowindow = new google.maps.InfoWindow();
    function initialize(){
    var mapOptions = {
    zoom: 18,
    center: myLatlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById("myMap"), mapOptions);
		var L1Coord = [
				 {lat: latt, lng:long},
				 {lat: latt+.005, lng: long+ 0.005}
			 ];
			 var L1 = new google.maps.Polyline({
				 path: L1Coord,
				 geodesic: true,
				 strokeColor: '#FF0000',
				 strokeOpacity: 1.0,
				 strokeWeight: 2
			 });
			 L1.setMap(map);



    marker = new google.maps.Marker({
    map: map,
    position: myLatlng,
    draggable: true
    });

    geocoder.geocode({'latLng': myLatlng }, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
    if (results[0]) {
    $('#latitude,#longitude').show();
    $('#address').val(results[0].formatted_address);
    $('#latitude').val(marker.getPosition().lat());
    $('#longitude').val(marker.getPosition().lng());
		lat = marker.getPosition().lat();
		long = marker.getPosition().lng();

    infowindow.setContent(results[0].formatted_address);
    infowindow.open(map, marker);
    }
    }
    });




    google.maps.event.addListener(marker, 'dragend', function() {
    geocoder.geocode({'latLng': marker.getPosition()}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
    if (results[0]) {
    $('#address').val(results[0].formatted_address);
    $('#latitude').val(marker.getPosition().lat());
    $('#longitude').val(marker.getPosition().lng());
		lat = marker.getPosition().lat();
		long = marker.getPosition().lng();

    console.log([marker.getPosition().lat(),marker.getPosition().lng()]);
    infowindow.setContent(results[0].formatted_address);
    infowindow.open(map, marker);
		L1Coord = [
				 {lat: latt, lng:long},
				 {lat: latt, lng: long+ 0.005675000000024966}
			 ];
			  L1 = new google.maps.Polyline({
				 path: L1Coord,
				 geodesic: true,
				 strokeColor: '#FF0000',
				 strokeOpacity: 1.0,
				 strokeWeight: 2
			 });
		L1.setMap(map);




    }
    }
    });
    });
		google.maps.event.addListener(marker, 'dragstart', function() {
		L1.setMap(null);

		});

    }
    google.maps.event.addDomListener(window, 'load', initialize);
		function buttonclick(){

				window.location.href='/confirm'
			}


			$(function(){
          var iosocket = io.connect();
            			iosocket.on('connect', function () {
                  console.log("connected");
       					});
						//
						iosocket.on('message', function(message) {
                   console.log(message)
            });
						//
			 			$('#confirm').click(function() {
                	iosocket.send([lat,long]);
									});
   });
		</script>




    <div id="myMap"></div>
    <input id="address" type="text" style="width:600px;"/><br/>
    <input type="text" id="latitude" placeholder="Latitude"/>
    <input type="text" id="longitude" placeholder="Longitude"/>
  </p>
	<!-- Colored raised button -->
	<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" id = "confirm" onclick="myVar = setTimeout(buttonclick, 1500)">
		Confirm center
	</button>

</div>
  </div>
</body>
</html>
